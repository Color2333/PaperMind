APP_ENV=production
APP_NAME=PaperMind API
API_HOST=0.0.0.0
API_PORT=8000

DATABASE_URL=sqlite:///./data/papermind.db

PDF_STORAGE_ROOT=./data/papers
BRIEF_OUTPUT_ROOT=./data/briefs
SKIM_SCORE_THRESHOLD=0.65
# 北京时间 05:00 执行每日任务（UTC 21:00）
DAILY_CRON=0 21 * * *
# 北京时间周日 06:00 执行每周图谱维护（UTC 22:00）
WEEKLY_CRON=0 22 * * 0
# Docker 部署: 用 * 允许所有来源，或填写实际域名
CORS_ALLOW_ORIGINS=*

# LLM Provider: openai / anthropic / zhipu
LLM_PROVIDER=zhipu

# OpenAI
OPENAI_API_KEY=
# Anthropic
ANTHROPIC_API_KEY=
# ZhipuAI (智谱)
ZHIPU_API_KEY=

SEMANTIC_SCHOLAR_API_KEY=
# OpenAlex（高速率引用源，填邮箱即可获得 10 req/s 免费配额）
OPENALEX_EMAIL=

LLM_MODEL_SKIM=glm-4.7
LLM_MODEL_DEEP=glm-4.7
LLM_MODEL_VISION=glm-4.6v
LLM_MODEL_FALLBACK=glm-4.7
EMBEDDING_MODEL=embedding-3

COST_GUARD_ENABLED=true
PER_CALL_BUDGET_USD=0.05
DAILY_BUDGET_USD=2.0

# ==========================================
# 站点认证配置
# ==========================================

# 站点密码，为空则禁用认证（公开访问）
# 设置后将要求输入密码才能访问系统
AUTH_PASSWORD=

# JWT 密钥（用于签名 token）
# 生产环境请修改为随机字符串
AUTH_SECRET_KEY=papermind-secret-key-change-in-production

# ==========================================
# SMTP 邮件配置
# ==========================================
SMTP_HOST=
SMTP_PORT=587
SMTP_USER=
SMTP_PASSWORD=
SMTP_FROM=
NOTIFY_DEFAULT_TO=

# ==========================================
# 智能调度配置 - UTC 时间（推荐）
# ==========================================

# 每日简报时间（UTC 时间）
# 推荐：0 4 * * * (UTC 4 点 = 北京时间 12 点，午饭时间)
# 说明：预留 2 小时处理缓冲
#       02:00 主题抓取 → 02:00-04:00 并行处理 → 04:00 生成简报
DAILY_CRON=0 4 * * *

# 每周图谱维护（UTC 时间）
# 推荐：0 22 * * 0 (UTC 周日 22 点 = 北京时间周一 6 点)
WEEKLY_CRON=0 22 * * 0

# 主题抓取默认时间（UTC 小时，0-23）
# 推荐：2 (UTC 2 点 = 北京时间 10 点)
DEFAULT_TOPIC_TIME_UTC=2

# 精读配额配置（每个主题每次最多精读篇数）
# 推荐：20 篇抓取 → 精读 1-3 篇（节省 LLM 费用）
DEFAULT_MAX_DEEP_READS=2

# ==========================================
# 闲时自动处理器配置
# ==========================================

# 是否启用闲时自动处理（true/false）
# 功能：系统空闲时自动批量处理未读论文（只粗读 + 嵌入，不精读）
IDLE_PROCESSOR_ENABLED=true

# 闲时批次处理数量（每次处理几篇）
# 推荐：5-10 篇（避免影响正常用户请求）
IDLE_BATCH_SIZE=5

# 空闲检测间隔（秒）
# 推荐：60 秒（每分钟检测一次）
IDLE_CHECK_INTERVAL=60

# 系统空闲阈值（用于闲时检测）
# CPU 使用率低于此值才认为是空闲
IDLE_CPU_THRESHOLD=30.0

# 内存使用率低于此值才认为是空闲
IDLE_MEMORY_THRESHOLD=70.0

# API 请求数低于此值才认为是空闲（请求数/分钟）
IDLE_REQUEST_THRESHOLD=5

# ==========================================
# Worker 重试配置
# ==========================================

# 任务失败最大重试次数
WORKER_RETRY_MAX=3

# 重试基础延迟（秒），使用指数退避
WORKER_RETRY_BASE_DELAY=5.0
